<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Metadata -->
        <meta charset="utf-8">
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta name="theme-color" content="#07889B">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <!-- Web Manifest -->
        <link rel="manifest" href="/webapp/build/manifest.webmanifest">
        
        <!-- Search Metadata (Needs to be short!) -->
        <meta name="description" content="An intuitive web app to help you explore and construct formal languages and automata with real-time analysis and error checking.">
        <!-- An intuitive web app to help you explore what it means to be computable. Experiment and construct formal languages from finite automata to Turing machines with real-time analysis and error checking. From its humble beginnings as a small tool built by a determined CSE 105 homework group at UC San Diego inspired by JFLAP, it has continued to still be developed by the students, for the students. -->
        <meta name="keywords" content="flap,flapjs,FLAPJS,JFLAP,Computation Theory,CSE 105,UCSD">

        <!-- Title -->
        <title id="window-title">Flap.js - Formal Languages and Automata Package in JavaScript</title>

        <!-- Import Google Fonts -->
        <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Overpass+Mono" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Arvo" rel="stylesheet">

<!-- Default Styles -->
<style>
html,
body {
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
    font-family: 'Lato', sans-serif;

    /* Disable drag-down reload behavior */
    overscroll-behavior-y: contain;
}

._center {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

#root {
    width: 100%;
    height: 100%;
}
</style>

<!-- Loading Styles -->
<style>
/** Loading styles **/
#loading {
    z-index: 9998;
    pointer-events: none;
    background: #FFFFFF;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

#root:not(:empty) + #loading {
    opacity: 0;
    visibility: hidden;
}

#loading ._spinner > div {
    display: inline-block;
    width: 24px;
    height: 24px;
    margin: 3px;
    background-color: #333333;
    border-radius: 50%;
    animation: _spinner-bouncedelay 1.4s 0s infinite ease-in-out both;
}

#loading ._spinner > div:first-child { animation-delay: 0.5s; }
#loading ._spinner > div:nth-child(2) { animation-delay: 0.66s; }
#loading ._spinner > div:last-child { animation-delay: 0.82s; }

@keyframes _spinner-bouncedelay {
    0%,
    80%,
    100% { transform: scale(0); }
    40% { transform: scale(1); }
}
</style>

<!-- Error Styles -->
<style>
/** Error styles **/
#error {
    z-index: 9999;
    pointer-events: none;
}

#error noscript {
    top: 48px;
}

#version {
    z-index: 9999;
    pointer-events: none;
    top: -64px;
    opacity: 30%;
    font-size: 0.8rem;
}

#restart {
    display: flex;
    flex-direction: column;
    top: 80px;
    transition: opacity 1s ease;
}

#restart p {
    margin: 0;
    margin-bottom: 0.5rem;
}

#restart button,
#restart a {
    pointer-events: all;
}

#restart[disabled] {
    opacity: 0;
    visibility: hidden;
}
</style>

<!-- NoFocusOutline Styles -->
<style>
/* SOURCE: https://jmperezperez.com/outline-focus-ring-a11y/ */
.no-focus-outline a:focus,
.no-focus-outline button:focus,
.no-focus-outline input:focus,
.no-focus-outline textarea:focus,
.no-focus-outline select:focus {
    outline: none;
}
</style>
<script>
/* SOURCE: https://jmperezperez.com/outline-focus-ring-a11y/ */
document.addEventListener('DOMContentLoaded', () =>
{
    document.body.classList.add('no-focus-outline');
    window.addEventListener('keyup', onFirstTabUp);
});

function onFirstTabUp(e)
{
    if (e.which === 9 /* The tab key */)
    {
        document.body.classList.remove('no-focus-outline');
        window.removeEventListener('keyup', onFirstTabUp);
    }
}

// KeepItSimpleSilly. Seriously, we could add back in the class to stop tabbing focus
// but, honestly, if you are tabbing, you will tab again.
</script>

    <!-- Styles -->
    <link href="/webapp/build/app.bundle.css" rel="stylesheet"></head>

    <body>
        <!-- CSS Support -->
        <div style="display: none;">
            Please enable CSS to run this app.
            We don't support no-css yet (please post a feature request).
        </div>
        
        <!-- React Root (must be next to loading spinner) -->
        <div id="root"></div>

        <!-- Loading Spinner (must be next to React root) -->
        <div class="_center" id="loading">
            <div class="_spinner"><div></div><div></div><div></div></div>

            <!-- Error Support -->
            <div id="error">
                <!-- Version Info -->
                <p class="_center" id="version">
                    Flap.js Web App
                    <span>
                        &nbsp;
                        v
                    </span>
                    0.5.0
                </p>
                <!-- JavaScript Support -->
                <noscript class="_center">You need to enable JavaScript to run this app.</noscript>
                <!-- Refresh Prompt -->
                <div class="_center" id="restart" disabled>
                    <p>
                        Taking too long?
                    </p>
                    <p>
                        On slower connections, this may take up to a minute or two.
                    </p>
                    <p>
                        Otherwise, try refreshing (or <a href=https://forms.gle/cyQFU9Ckgs5mr8D4A>report the bug</a>).
                        &nbsp;
                        <button id="restartButton">Refresh Now</button>
                    </p>
                </div>
                <!-- Too Long Restart Prompt -->
                <script>
const TOO_LONG_RESTART_INTERVAL_TIME = 5000;
document.querySelector('#restartButton').addEventListener('click', onRestartButtonClick);
setInterval(onTooLongRestartIntervalUpdate, TOO_LONG_RESTART_INTERVAL_TIME);

function onTooLongRestartIntervalUpdate()
{
    let nonEmptyRoot = document.querySelector('#root:not(:empty)');
    if (nonEmptyRoot)
    {
        showPrompt(false);
    }
    else
    {
        showPrompt(true);
    }
}

function showPrompt(value)
{
    let restartContainer = document.querySelector('#restart');
    restartContainer.toggleAttribute('disabled', !value);
    let restartButton = document.querySelector('#restartButton');
    restartButton.toggleAttribute('disabled', !value);
}

function onRestartButtonClick()
{
    window.location.reload();
}
</script>
            </div>
        </div>

<!-- Global Variables -->
<script>
    // NOTE: ServiceWorker will only be enabled in 'production'.
    const __NODE_ENV__ = 'production';
    if (__NODE_ENV__ !== 'production') document.getElementById('root').classList.add('debug');
</script>

<!-- Service Worker Install -->
<script>
/* global __NODE_ENV__ */

// NOTE: __NODE_ENV__ is defined in `template.html` as a global.
if (__NODE_ENV__ === 'production' && 'serviceWorker' in navigator)
{
    window.addEventListener('load', function() 
    {
        navigator.serviceWorker.register('/webapp/build/service-worker.js').then(registration =>
        {
            // https://redfin.engineering/service-workers-break-the-browsers-refresh-button-by-default-here-s-why-56f9417694
            // https://redfin.engineering/how-to-fix-the-refresh-button-when-using-service-workers-a8e27af6df68

            function listenForWaitingServiceWorker(reg, callback)
            {
                function awaitStateChange()
                {
                    reg.installing.addEventListener('statechange', function()
                    {
                        if (this.state === 'installed') callback(reg);
                    });
                }
                if (!reg) return;
                if (reg.waiting) return callback(reg);
                if (reg.installing) awaitStateChange();
                reg.addEventListener('updatefound', awaitStateChange);
            }

            // Reload once when the new service worker starts activating...
            var refreshing;
            navigator.serviceWorker.addEventListener('controllerchange', function()
            {
                if (refreshing) return;
                refreshing = true;
                window.location.reload();
            });

            function promptUserToRefresh(reg)
            {
                const UNRELEASED_HEADER = '## [Unreleased]';
                const VERSION_HEADER_PREFIX = '##';

                function parseChangelog(changelogText)
                {
                    let i = changelogText.indexOf(UNRELEASED_HEADER) + UNRELEASED_HEADER.length;
                    let j = changelogText.indexOf(VERSION_HEADER_PREFIX, i);
                    let k = changelogText.indexOf(VERSION_HEADER_PREFIX, j + VERSION_HEADER_PREFIX.length);

                    return changelogText.substring(j, k);
                }

                fetch('./CHANGELOG.md').then(async response =>
                {
                    let changelog = parseChangelog(await response.text());
                    let header = 'New version available! Ready to refresh?';

                    if (window.confirm(header + '\n\n' + changelog))
                    {
                        reg.waiting.postMessage('skipWaiting');
                    }
                }).catch(e =>
                {
                    if (window.confirm('New version available! Ready to refresh?'))
                    {
                        reg.waiting.postMessage('skipWaiting');
                    }
                });
            }

            listenForWaitingServiceWorker(registration, promptUserToRefresh);
        });
    });
}
</script>

<!-- Exit Warning -->
<script>
/* global __NODE_ENV__ */

window.addEventListener('beforeunload', (event) => 
{
    // if (window.shouldExitWarning)
    if (__NODE_ENV__ === 'production')
    {
        const message = 'alert.warning.exit';
        event = event || window.event;
        // For IE and Firefox
        if (event) event.returnValue = message;
        // For Safari
        return message;
    }
});
</script>

        <!-- Library Files -->
        <!-- <script crossorigin> https://unpkg.com/react@16/umd/react.production.min.js -->
        <script defer src="/webapp/build/libs/react.production.min.js"></script>
        <!-- <script crossorigin> https://unpkg.com/react-dom@16/umd/react-dom.production.min.js -->
        <script defer src="/webapp/build/libs/react-dom.production.min.js"></script>
        <!-- <script crossorigin> https://unpkg.com/prop-types@15.6/prop-types.min.js -->
        <script defer src="/webapp/build/libs/prop-types.min.js"></script>

    <!-- Bundles -->
    <script type="text/javascript" src="/webapp/build/app.bundle.js" defer></script></body>
</html>