<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Metadata -->
        <meta charset="utf-8">
        <meta http-equiv="Content-type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta name="theme-color" content="#07889B">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">

        <!-- Web Manifest -->
        <link rel="manifest" href="/webapp/build/manifest.webmanifest">
        
        <!-- Search Metadata (Needs to be short!) -->
        <meta name="description" content="An intuitive web app to help you explore and construct formal languages and automata with real-time analysis and error checking.">
        <!-- An intuitive web app to help you explore what it means to be computable. Experiment and construct formal languages from finite automata to Turing machines with real-time analysis and error checking. From its humble beginnings as a small tool built by a determined CSE 105 homework group at UC San Diego inspired by JFLAP, it has continued to still be developed by the students, for the students. -->
        <meta name="keywords" content="flap,flapjs,FLAPJS,JFLAP,Computation Theory,CSE 105,UCSD">

        <!-- Title -->
        <title id="window-title">Flap.js - Formal Languages and Automata Package in JavaScript</title>

        <!-- Import Google Fonts -->
        <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Overpass+Mono" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Arvo" rel="stylesheet">

<!-- Default Styles -->
<style>
html,
body {
    width: 100%;
    height: 100%;
    padding: 0;
    margin: 0;
    font-family: 'Lato', sans-serif;

    /* Disable drag-down reload behavior */
    overscroll-behavior-y: contain;
}

._center {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
}

#root {
    width: 100%;
    height: 100%;
}
</style>

<!-- Loading Styles -->
<style>
/** Loading styles **/
#loading {
    z-index: 9998;
    pointer-events: none;
    background: #FFFFFF;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

#root:not(:empty) + #loading {
    opacity: 0;
    visibility: hidden;
}

#loading ._spinner > div {
    display: inline-block;
    width: 24px;
    height: 24px;
    margin: 3px;
    background-color: #333333;
    border-radius: 50%;
    animation: _spinner-bouncedelay 1.4s 0s infinite ease-in-out both;
}

#loading ._spinner > div:first-child { animation-delay: 0.5s; }
#loading ._spinner > div:nth-child(2) { animation-delay: 0.66s; }
#loading ._spinner > div:last-child { animation-delay: 0.82s; }

@keyframes _spinner-bouncedelay {
    0%,
    80%,
    100% { transform: scale(0); }
    40% { transform: scale(1); }
}

/** Error styles **/
#error {
    z-index: 9999;
    pointer-events: none;
    top: 64px;
}
</style>

    <!-- Styles -->
    <link href="/webapp/build/app.bundle.css" rel="stylesheet"></head>

    <body>
        <!-- React Root -->
        <div id="root"></div>
        
        <!-- Loading Spinner -->
        <div class="_center" id="loading">
            <div class="_spinner"><div></div><div></div><div></div></div>
        </div>

        <!-- JavaScript Support -->
        <div class="_center" id="error">
            <noscript>You need to enable JavaScript to run this app.</noscript>
        </div>

<!-- Global Variables -->
<script>
    // NOTE: ServiceWorker will only be enabled in 'production'.
    const NODE_ENV = 'production';
</script>

<!-- Service Worker Install -->
<script>
/* global NODE_ENV */

// NOTE: NODE_ENV is defined in `template.html` as a global.
if (NODE_ENV === 'production' && 'serviceWorker' in navigator)
{
    window.addEventListener('load', function() 
    {
        navigator.serviceWorker.register('/build/service-worker.js').then(registration =>
        {
            // https://redfin.engineering/service-workers-break-the-browsers-refresh-button-by-default-here-s-why-56f9417694
            // https://redfin.engineering/how-to-fix-the-refresh-button-when-using-service-workers-a8e27af6df68

            function listenForWaitingServiceWorker(reg, callback)
            {
                function awaitStateChange()
                {
                    reg.installing.addEventListener('statechange', function()
                    {
                        if (this.state === 'installed') callback(reg);
                    });
                }
                if (!reg) return;
                if (reg.waiting) return callback(reg);
                if (reg.installing) awaitStateChange();
                reg.addEventListener('updatefound', awaitStateChange);
            }

            // Reload once when the new service worker starts activating...
            var refreshing;
            navigator.serviceWorker.addEventListener('controllerchange', function()
            {
                if (refreshing) return;
                refreshing = true;
                window.location.reload();
            });

            function promptUserToRefresh(reg)
            {
                // TODO: This is just an example, please do something better...
                if (window.confirm('New version available! OK to refresh?'))
                {
                    reg.waiting.postMessage('skipWaiting');
                }
            }

            listenForWaitingServiceWorker(registration, promptUserToRefresh);
        });
    });
}
</script>

<!-- Exit Warning -->
<script>
/* global NODE_ENV */

window.addEventListener('beforeunload', (event) => 
{
    // if (window.shouldExitWarning)
    if (NODE_ENV === 'production')
    {
        const message = 'alert.warning.exit';
        event = event || window.event;
        // For IE and Firefox
        if (event) event.returnValue = message;
        // For Safari
        return message;
    }
});
</script>

        <!-- Library Files -->
        <!-- <script crossorigin> https://unpkg.com/react@16/umd/react.production.min.js -->
        <script defer src="/webapp/build/libs/react.production.min.js"></script>
        <!-- <script crossorigin> https://unpkg.com/react-dom@16/umd/react-dom.production.min.js -->
        <script defer src="/webapp/build/libs/react-dom.production.min.js"></script>
        <!-- <script crossorigin> https://unpkg.com/prop-types@15.6/prop-types.min.js -->
        <script defer src="/webapp/build/libs/prop-types.min.js"></script>

    <!-- Bundles -->
    <script type="text/javascript" src="/webapp/build/app.bundle.js" defer></script></body>
</html>